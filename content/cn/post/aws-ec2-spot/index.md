---
title: "终极省钱秘诀: AWS EC2 Spot Instance & Spot Fleet"
date: 2025-02-23T11:58:15+01:00
Description: ""
Tags: []
Categories: []
DisableComments: false
summary: "最近在备考 AWS 的 SAA，所以特别学习了一下 AWS 的 Spot Instance 相关的知识点。本文总结了如何使用 AWS Spot 实例降低 70%-90% 计算成本，结合 Auto Scaling Group、Spot Fleet 和价格监测策略，提高稳定性并优化费用，让云计算更具性价比。"
---

## 为什么选择 Spot 实例？

在云计算的世界里，能省一分是一分！AWS EC2 Spot 实例是省钱的终极利器，价格比按需实例低 **70%-90%**！是不是很香？但是，便宜的东西总有点门道，我们一起来揭开它的神秘面纱。

## 什么是 Spot 实例？
Spot 实例是 AWS EC2 的一个高级功能，它允许你在 AWS 上运行实例，但同时允许 AWS 释放你的实例。当 AWS 需要释放你的实例时，它将通知你，并允许你选择是否继续运行实例。 Spot 实例的一个主要优势是，它们比按需实例便宜，但同时，它们也有一个主要缺点，即它们可能会被 AWS 释放。简单来说，Spot 实例就是 AWS **剩余计算资源的临时特价版**。你只需要设定一个**最高可接受价格（Max Spot Price）**，当当前市场价低于你设定的价格时，你就能抢到实例。

## Spot 价格如何变化？

AWS 以市场供需来调整 Spot 实例的价格，每小时都会**动态变化**。

如果 **当前市场价** > **你的 Max Spot Price**，AWS 会给你 2 分钟宽限期，你可以选择：

Stop（停止）：关机但不删除实例，EBS 数据保留，但 RAM 数据丢失，它会等便宜的时候再继续跑。

Terminate（终止）：干脆利落，等 AWS 资源便宜了再重新起一个新的实例。

Hibernate（休眠）：暂停任务，**内存数据保留在 EBS 里**(是的，所以你需要确保你的实例拥有足够的 EBS 容量)。在下次启动时，实例会从 EBS 中恢复数据, 即恢复休眠前的运行状态。


💡 小贴士：Spot 价格在低谷期可能会长时间保持低价，但高峰期价格波动较大，合理设定 Max Spot Price 很关键！

## Spot Request 与 Spot Fleet
### Spot Request 是什么？

Spot Request 是你向 AWS 提交的单独请求，用于申请一个或多个 Spot 实例。它可以在创建 EC2 实例时在高级详细信息中设置，选择**竞价型实例**作为购买选项。

#### 工作流程

- 提交请求：你需要指定 Spot 价格上限、实例类型、区域等信息。

- 匹配请求：AWS 会检查当前 Spot 价格是否低于你的出价，并查看是否有可用资源。

- 实例启动：如果资源可用，AWS 就会启动你的 Spot 实例。

- 运行任务：你的实例正常运行，享受低价计算资源。

- 价格或容量变更：如果 Spot 价格上涨超过你的最高出价，或者 AWS 资源短缺，实例可能会被终止或停止。

- 终止或重试：如果实例被终止，你可以选择重新提交请求，或者如果你定义了持久性请求，它会在有合适的价格时重新启动。

<img src="./images/spot_lifecycle.png" alt="spot_lifecycle" width="600" />

### Spot Fleet 是什么？

Spot Fleet 是 AWS 的“自动捡漏”工具，它允许你同时申请多个 Spot 实例，并根据价格、可用性动态调整，确保计算任务稳定运行。

#### Spot Fleet 与 Spot Request 的区别：

Spot Request 只申请单个 Spot 实例，如果被终止，需要手动重新申请。

Spot Fleet 可以管理多个实例，自动调整实例类型和数量，减少中断的影响。

#### Spot Fleet 的好处：

智能调度：AWS 自动选择最便宜、最稳定的 Spot 实例。

高可用性：可以混合不同实例类型，减少单点故障的风险。

更灵活的预算控制：你可以设定预算上限，避免花费超标。

💡 使用技巧：搭配 `On-Demand` 实例使用，提高整体稳定性！

## 哪些任务适合用 Spot 实例？
Spot 实例适合 **非关键性任务**，也就是 **可中断**、**能重试** 的任务，比如：

✅ 批处理任务（Batch Jobs）：批量计算任务本身就是分批执行的，Spot 终止了也能自动重试。

✅ 数据分析（Data Analysis）：大规模计算任务通常不需要秒级响应，Spot 性价比高。

✅ 容错性强的任务（Fault-Tolerant Workloads）：只要架构设计得当，Spot 终止并不会影响业务。

💡 小贴士：很多 AI/ML 训练任务都能利用 Spot 省钱！比如深度学习模型训练，可以在 Spot 终止时暂停，下次继续训练！

🚨 但是注意！以下任务不适合使用 Spot 实例：

❌ 关键性任务（Critical Jobs）：如果任务中断会影响业务，就别冒险了！

❌ 数据库（Databases）：数据库掉了，恢复可不是小事！


## 终极省钱秘诀
最后，让我们来总结一些 Spot 实例的省钱技巧。如果你想充分利用 AWS Spot 实例的成本优势，以下几个策略可以帮助你以最低成本获取最大计算力:

### 秘诀 1：选择合适的实例类型

有些实例类型 Spot 价格特别便宜，像 t3, m5, c5 这些是热门选择，可以重点关注。

### 秘诀 2：使用 Spot Advisor 工具

AWS 提供了 [Spot Instance Advisor](https://aws.amazon.com/ec2/spot/instance-advisor/) ，可以查询不同实例类型的历史价格、稳定性等信息，助你找到最划算的选择。

### 秘诀 3：混合 Spot 和 按需实例

使用 Auto Scaling Group（ASG）结合混合实例策略，在关键任务里，例如可以用 **50% 按需实例** + **50% Spot 实例** 的方式，既省钱又不影响业务连续性。ASG 会根据工作负载自动扩展，并在 Spot 资源不足时，自动回退到按需实例，确保高可用性，同时降低计算成本。

### 秘诀 4：在价格低谷期启动长时间任务

观察价格趋势，使用 **AWS Spot Pricing API** 查询不同时间段的 Spot 价格或者结合 **AWS EventBridge + Lambda** 触发 Spot 实例等方式，找价格低谷期启动任务，最大化省钱。


## 结语

AWS EC2 Spot 实例是一个**极具性价比**的选择，只要合理利用，你可以用 **最低的成本跑出最高的计算能力**！

总的来说，它省钱——比按需实例便宜 70% - 90%。它适合批量计算任务，但不适合数据库和关键任务，所以使用之前要好好想一下哪些服务可以用 Spot 代替，哪些不可以，又有哪些可以局部代替。此外，我们还可以使用 Auto Scaling Group 让 Spot 实例自动扩展，根据工作负载需求调整实例数量，提高弹性和可用性。


